---
title: "Module 4 : Service web & clients"
description: "Cr√©ation de services web, de RESTful API & requ√™tes clientes"
---

# Module 4 : Service web & clients
Ce module vous offre principalement la cr√©ation de services web et la mise en place de 
requ√™tes clientes pour tester des RESTful API.

<br/>

Voici les sujets trait√©s :
- a) [Introduction au backend](#a)
- b) [Introduction √† Node.js](#b)
    - b.1) [Introduction](#b1)
    - b.2) [Ou mettre du code Node.js ?](#b2)
    - b.3) [Les modules CommonJS](#b3)
    - b.4) [Introduction aux packages](#b4)



<br/>

# <a id="a"></a>a) Introduction au backend
## a.1) Frontend, backend, c'est quoi ?
Un **frontend**, c'est une application :
- qui s'ex√©cute c√¥t√© client, une IHM, qu'on pourrait aussi appeler UI ;
- qui est en direct interaction avc l'utilisateur ;
- impl√©ment√©, dans ce cours-ci, en HTML / CSS / JS.

Un **backend**, c'est une application :
- qui s'ex√©cute c√¥t√© serveur ; 
- qui n'offre pas d'interaction directe avec l'utilisateur ;
- qui parfois met √† disposition le **frontend** ;
- qui parfois offre des op√©rations sur des donn√©es.

## a.2) R√¥les principaux du backend
### a.2.1) Fourniture du frontend
Un des r√¥les du backend est de fournir le frontend :
- **via un serveur de fichiers statiques** ; c'est la mise √† disposition des assets : fichiers HTML,
CSS, JS, images...
- **via la g√©n√©ration dynamique de pages HTML** ; c'est ce qui se passe quand le backend 
fait du Server Side Rendering (SSR), g√©n√©ralement dans le cadre de Multi Page Applications.  

Dans le cadre de ce cours, nous ne ferons pas de g√©n√©ration dynamique d'HTML c√¥t√© serveur (ou SSR).  
Par contre, nous avons d√©j√† vu :
- comment faire de la g√©n√©ration dynamique d'HTML c√¥t√© client (ou 
Client Side Rendering = CSR).
- mettre √† disposition notre frontend, notre IHM, √† l'aide d'un serveur de fichiers statiques : 
c'est ce que notamment fait le serveur de d√©veloppement de Webpack, il me √† disposition les assets 
permettant au browser d'ex√©cuter l'application web.

### a.2.2) Fourniture d'op√©rations sur des ressources
Un autre r√¥le important du backend est de mettre √† disposition des op√©rations sur des ressources,
c'est ce qu'on appelle les services web ou web API.

Il existe diff√©rents types de technologies et architectures web permettant d'impl√©menter 
des web services, notamment :
- **RESTful API** ; c'est l'architecture qui actuellement est la plus utilis√©e et qui sera apprise dans 
le cadre de ce cours.
- **GraphQL API** ; c'est une technologie r√©cente qui permet de tr√®s rapidement cr√©er des requ√™tes 
sur des ressources et qui a √©t√© cr√©√©e par Facebook ; nous ne verrons pas cette technologie dans 
le cadre de ce cours.
- **SOAP API** ; c'est une fa√ßon ancienne de cr√©er des op√©rations sur des ressources mettant en 
oeuvre de l'XML pour communiquer entre des applications clients / serveurs. Nous ne verrons 
pas cette technologie dans le cadre de ce cours.

### a.2.3) Autres r√¥les du backend ?
Un backend peut offrir d'autres services, comme :
- **proxy** : interm√©diaire entre les clients demandant une ressource et le serveur fournissant 
cette ressource. On verra ce type de service, notamment pour masquer l'origine d'une requ√™te √† 
une API.
- **reverse proxy** : c'est un serveur qui fait l'interm√©diaire avec d'autres serveurs, cachant 
au client qui est le v√©ritable serveur ayant trait√© de sa requ√™te. Par exemple, un proxy serveur 
peut mettre √† disposition des acc√®s √† des serveurs interne √† une entreprise (non visibles sur le web)
alors que le client interroge un serveur qui est visible sur le web.
- **serveur d'emails** ;
- ...

### a.2.3) Technologies backend possibles

Voici un exemple de technologies qui pourrait √™tre mises en oeuvre pour d√©velopper une application
backend :

<ScrollableImage name="techno.png" minWidth="586px" maxWidth="586px" />

  <figcaption>Technologies backend possibles</figcaption>

### a.2.4) Technologies backend s√©lectionn√©es pour ce cours

Voici les technologies qui ont √©t√© choisies pour √™tre mises en oeuvre 
pour d√©velopper une application backend en JS :

<ScrollableImage name="techno-course.png" minWidth="721px" maxWidth="721px" />

  <figcaption>Technologies backend en JS choisies pour ce cours</figcaption>

Nous allons utiliser Express comme framework pour rapidement d√©velopper des applications Node.js.

# <a id="b"></a>b) Introduction √† Node.js
## <a id="b1"></a> b.1) Introduction
Node.js est un environnement serveur open source permettant la cr√©ation d'outils 
et applications c√¥t√© serveur en JS.  
Node.js offre une utilisation optimale des ressources des serveurs sans d√©pendance 
√† un serveur http externe, tout en √©tant multiplateforme (Windows, Linux, Mac‚Ä¶).

Pour le d√©veloppement d'IHM de fa√ßon modernes, vous avez d√©j√† install√© l'environnement
Node.js. Mais si √ßa n'est pas install√©, il est important que vous installiez l'environnement 
[Node.js en version LTS](https://nodejs.org/en/) [[R.34]](/references/#r34).

Vous ne devez pas apprendre un nouveau langage pour d√©velopper des applications backend, 
Node.js, c'est du JS.  
Si vous avez besoin d'un rappel du langage, vous pouvez le faire ici : [Introduction au langage JS](/intro/#e).

Tr√®s souvent, Node.js est cod√© en JS conforme au standard CommonJS.
La gestion des modules est diff√©rente du JS conforme au standard ECMAScript, telle que nous avons
appris pour du JS c√¥t√© browser.

M√™me s'il est possible d'√©crire du Node.js conforme au standard ECMAScript, la majorit√© du code 
que vous trouverez sur le web sera conforme √† CommonJS.

D√®s lors, nous allons vous expliquer plus tard comment g√©rer des modules en Node.js conforme au 
standard CommonJS.

## <a id="b2"></a> b.2) Ou mettre du code Node.js ?
### b.2.1) Directement dans un terminal
Il est possible d'√©crire du code Node.js directement dans un terminal.

Pour rappel, nous vous conseillons d'utiliser Git Bash comme terminal au sein de VS Code. 

Vous devriez d√©j√† avoir configur√© VS Code pour avoir comme Terminal par d√©faut 
Git Bash. Si √ßa n'est pas fait, nous vous rappelons la proc√©dure :
- Vous devez avoir install√© Git sur votre machine.
- Clicquez √† droite du **+** au sein d'un terminal ouvert dans VS Code, 
clic sur **Select Default Profile**, puis s√©lectionnez "Git Bash".
Tous les prochains terminaux que vous ouvrirez le seront sous Git Bash, nettement plus color√© 
et int√©ressant que les autres terminaux üòé.

<ScrollableImage name="terminal-2.png" minWidth="933px" maxWidth="933px" />

<figcaption>Choix du terminal par d√©faut</figcaption>

Veuillez tester du code Node.js directement dans un terminal en tapant 
cela au sein d'un terminal de VS Code :

```bash
node
```

Vous avez maintenant acc√®s au terminal de Node.js.  
Vous pouvez tenter une op√©ration math√©matique de votre choix, comme par exemple :
**2 * Math.PI**

Incroyable mais vrai, vous avez maintenant acc√®s √† une nouvelle calculatrice sur tous les appareils 
o√π vous avez Node.js install√©. Et si Node.js n'est pas install√©, pas de panique, 
la console de votre Browser pourra toujours vous aider üòâ.

Quand vous souhaitez sortir de l'interpr√©teur de commandes de Nodes, il faut taper :
- soit deux fois **`CTRL c`**
- soit **`CTRL d`**

### b.2.2) Dans un script
Nous √©crivons g√©n√©ralement le code Node.js au sein d'un script externe.

Dans votre repo **web2**, veuillez cr√©er un r√©pertoire **/tutorials/node-start** et y 
ajouter le fichier **start.js** contenant ce code-ci :

```js
class Car {
  constructor(brand, model) {
    this.brand = brand;
    this.model = model;
    this.id = Math.random();
  }

  getDescription() {
    return `Car's description : ${this.brand}, ${this.model} , ID:${this.id}`;
  }
}

const dacia = new Car('Dacia', 'Sandero');

console.log( dacia.getDescription() );
```

Pour lancer une application Node.js, il suffit de taper dans un terminal : **`node nomScript`** 
(**`.js`** est optionnel).

Donc pour lancer le script cr√©√© ci-dessus, veuillez ouvrir un terminal au bon endroit.  
Pour rappel, Il est possible de faire un clic droit dans l'Explorer de VS Code 
sur le r√©pertoire **node-start**, **Open in Integrated Terminal** pour ouvrir un terminal 
√† l'endroit souhait√©.

Il ne vous reste plus qu'√† taper :

```bash
node start # or node start.js
```

Voila, c'est une simple application Node.js qui affiche un message dans le terminal.

## <a id="b3"></a> b.3) Les modules CommonJS
### b.3.1) Introduction
Un module est une librairie JS fournissant des objets.
Comme en JS tout est objet, un module met donc √† disposition des fonctions, des constantes, des variables...

### b.3.2) Cr√©ation d'un module
Pour cr√©er un module, il suffit de cr√©er un script JS **nomModule.js** et d'exporter des
objets au sein de ce module via **module.exports** ou **exports**.

### b.3.3) Exporter des objets
#### b.3.3.1) Introduction
Il existe plusieurs fa√ßons d'exporter des objets, soit √† la vol√©e, soit √† la fin d'un script.

üëç Nous vous recommandons de faire vos exports √† la fin du script, cela rend les scripts plus 
lisibles. 

Nous allons n√©anmoins voir toutes les fa√ßons d'exporter des objets en CommonJS, car vous trouverez
de tout sur le web.

On exporte toujours un seul objet principal dans un module. Cet objet peut bien s√ªr contenir 
une multitude d'objets via ses propri√©t√©s.

#### b.3.3.2) Export √† la fin d'un script
C'est la fa√ßon la plus propre d'exporter un seul objet :

```js
module.exports¬†=¬†router;
```

C'est l'√©quivalent d'un "default export" tel que vu en ECMAScript.

S'il y a plusieurs objets √† exporter, voici la fa√ßon recommand√©e de le faire : 

```js
module.exports¬†=¬†{authorize,¬†users¬†};
```

C'est l'√©quivalent d'un "Named export" tel que vu en ECMAScript.

#### b.3.3.3) Export √† la vol√©e

Il est possible de faire des exports √† la vol√©e, c'est √† dire d'exporter des objets 
au fur et √† mesure qu'ils sont initialis√©s.

Voici la version longue :

```js
module.exports.authorize¬†=¬†authorize;
module.exports.users¬†=¬†users¬†;
```

Il est aussi possible d'√©courter une export √† la vol√©e : 
```js
exports.authorize¬†=¬†authorize;
exports.users¬†=¬†users¬†;
```

Voici quelques pr√©cisions :
- **`module.exports`** : c'est la r√©f√©rence de l'objet retourn√©e par l'appel de **`required()`** 
(m√©thode qui sera utilis√©e pour l'import).
- **`exports`** : c'est la r√©f√©rence vers **`module.exports`**, **`exports`** 
n'est pas retourn√© par l'appel de **`required()`**.

‚ö° Il faut faire attention au mauvais usage de l'utilisation de **`exports`**. 
Voici une mauvaise utilisation :

```js
exports¬†=¬†{¬†authorize,¬†users¬†};¬†/*¬†exports¬†has¬†a¬†new¬†reference,¬†
                                   it¬†is¬†no¬†longer¬†linked¬†to¬†module.exports */
```

### b.3.4) Importer des objets
#### b.3.4.1) Introduction
Pour utiliser des objets (fonctions, constantes, objets, classes...) au sein d'un script JS 
provenant de modules, on le fait √† l'aide de la fonction **`required()`** et du 
chemin vers le module √† utiliser.

Il est possible d'importer tant des objets de modules que l'on a cr√©√© soi-m√™me, 
que de packages mis √† disposition via un gestionnaire de packages.

#### b.3.4.2) Import d'un module
Lorsqu'un seul objet a √©t√© export√©, on l'importe en lui donnant le nom que l'on souhaite 
√† l'import et en indiquant le chemin vers le module √† utiliser.

```js
const¬†pizzaRouter¬†=¬†require('./routes/pizzas');
```

Lorsque plusieurs objets ont √©t√© export√©s, on importe ce que l'on souhaite en utilisant 
des accolades et en indiquant le chemin vers le module √† utiliser.

```js
const¬†{¬†users,¬†authorize¬†}¬†=¬†require('../utils/auths');
```

#### b.3.4.2) Import d'un package
Il est aussi possible d'importer des objets de packages offerts par la 
communaut√© via votre gestionnaire de package.
Pour ce faire, il est juste n√©cessaire d'indiquer le nom du package lors de l'import.

Si un seul objet est export√© par un package, voici un exemple de comment le r√©cup√©rer :

```js
//¬†module¬†integrated¬†to¬†the¬†runtime¬†environment
const¬†http¬†=¬†require('http');
//¬†module¬†following package installation
const¬†shortid¬†=¬†require('shortid');
```

## <a id="b4"></a> b.4) Introduction aux packages
### b.4.1) Introduction
Dans le cadre du d√©veloppement d'IHM modernes, au module 2, nous avons d√©couvert le gestionnaire 
de packages de Node.js. Nous allons r√©sumer les concepts importants ci-dessous.

### b.4.2) Gestionnaire de packages
**npm** est le gestionnaire de packages de Node.js. 

On peut faire des recherches de packages qui serait utiles √† nos application web 
sur [npmjs.com](https://www.npmjs.com/) [[R.48]](/references/#r48).

### b.4.3) Fichier de configuration d'un projet
Tous les packages associ√©s √† une app, ses d√©pendances, sont donn√©es dans le fichier :
**package.json**.

C'est le fichier qui d√©crit la configuration d'un projet JS.

On peut manuellement cr√©er ce fichier √† l'aide de la commande **`npm init`** 
ou **`npm init -y`** si l'on souhaite quelque chose de plus interactif.

Voici un exemple de fichier **package.json** :

```json
{
  "name": "api2",
  "version": "0.0.0",
  "private": true,
  "scripts": {
    "debug": "npm run dev",
    "dev": "nodemon ./bin/www",
    "start": "node ./bin/www",
    "lint": "eslint **/*.js",
    "lint:fix": "npm run lint -- --fix"
  },
  "nodemonConfig": {
    "ignore": [
      "data/*"
    ],
    "exec": "npm run lint && node"
  },
  "dependencies": {
    "cookie-parser": "~1.4.4",
    "debug": "~2.6.9",
    "express": "~4.16.1",
    "morgan": "~1.9.1"
  },
  "devDependencies": {
    "eslint": "^8.19.0",
    "eslint-config-airbnb-base": "^15.0.0",
    "nodemon": "^2.0.19",
    "prettier-airbnb-config": "^1.0.0"
  },
  "author": "e-Baron"
}
```

Lors de l'installation d'un package, 
celui-ci s'ajoute √† la liste des d√©pendances.  
Ainsi, si des d√©veloppeurs trouvent votre projet sur Git,
ils n'auront qu'√† ex√©cuter **`npm i`** afin d'installer toutes les d√©pendances.

C'est dans le r√©pertoire **node_modules** que toutes les d√©pendances seront install√©es. 
Ces d√©pendances peuvent √™tre tr√®s volumineuses. C'est donc important de ne jamais 
mettre ce dossier sur vos web repository, via Git.  
Pour ce faire, n'oubliez pas d'inclure un fichier **.gitignore** dans vos repos 
pour ignore **node_modules**.

### b.4.4) Installer un package
Pour installer un package (ou une d√©pendance), 
il suffit de faire : **`npm i nomDuPackage`** ou **`npm install nomDuPackage`**.

### b.4.5) D√©pendances install√©es
On a vu que **`npm i`** permet d'installer toutes les d√©pendances se trouvant dans 
**package.json**, ainsi que toutes les d√©pendances de ces d√©pendances...

L'arbre exact des d√©pendances install√©es, num√©ro de version..., se trouve dans 
**package-lock.json**. Ce fichier est g√©n√©r√© automatiquement pour chaque op√©ration
modifiant **node_modules** ou **package.json**.

‚ö° Si un fichier **package-lock.json** est compris dans un repo, lorsque vous introduirez 
**`npm i`** pour installer toutes les d√©pendances, npm installera les m√™mes versions que celles 
se trouvant dans **package-lock.json**. Cela peut poser des probl√®mes si votre environnement 
Node.js est en version diff√©rente. En cas de souci, pensez √† effacer le r√©pertoire **node_modules** 
et le fichier **package-lock.json** avant de relancer l'installation de toutes les d√©pendances.

### b.4.6) Localisation d'un module ou package par Node
Node va chercher dans tous les chemins sp√©cifi√©s dans **module.paths** : **node_modules**, **.**...
lorsque **`required()`** est appel√©.

### b.4.7) Mise √† jour des packages vers leur derni√®re version
La mise √† jour de toutes les d√©pendances peut parfois amener √† des gros soucis.

Vous pouvez tenter de mettre √† jour tous vos package en suivant la documentation de Node.js :
[Update all the Node.js dependencies to their latest version](https://nodejs.dev/learn/update-all-the-nodejs-dependencies-to-their-latest-version)
[[R.49]](/references/#r49)

Mais attention, certains packages parfois subissent des "breaking changes", 
ce qui impose que vous deviez faire migrer votre code avant que celui-ci soit fonctionnel.

Nous vous recommandons donc, si vous rencontrer un probl√®me lors de la mise √† jour de tous vos 
packages d'un coup, de revenir √† la situation initiale, et de faire l'upgrade de chaque 
package list√© dans **package.json** individuellement.